<!DOCTYPE html>
<html lang="en">

<!-- Sound Samples from: https://codepen.io/amdsouza92/pen/xdooWa -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONOTONE | ISLANDS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        mono: ['Space Mono', 'monospace']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');

        * {
            font-family: 'Space Mono', monospace;
        }

        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        .step-btn {
            transition: all 0.1s;
        }

        .step-btn:hover {
            transform: scale(1.1);
        }

        .step-active {
            background: #000 !important;
        }

        .sequencer-panel {
            transition: transform 0.3s ease;
        }

        .sequencer-hidden {
            transform: translateY(100%);
        }
    </style>
</head>

<body class="bg-white">
    <canvas id="stage"></canvas>

    <!-- Top Left Info -->
    <div class="fixed top-4 left-4 text-xs z-50 pointer-events-none select-none">
        <div class="bg-black text-white px-3 py-2 mb-2 flex items-center gap-2">
            <i class="fas fa-drum"></i>
            MONO<span class="text-[8px] align-super">TONE</span>
        </div>
        <div class="bg-white border border-black px-3 py-2 text-[10px] leading-tight">
            <div class="mb-2 flex items-center gap-2">
                <i class="fas fa-mouse-pointer"></i>
                <i class="fas fa-circle text-[6px]"></i>
            </div>
            <div class="mb-2 flex items-center gap-2">
                <i class="fas fa-hand-pointer"></i>
                <i class="fas fa-water text-[6px]"></i>
            </div>
            <div class="flex items-center gap-2">
                <kbd class="px-1 border border-black text-[8px]">SPC</kbd>
                <i class="fas fa-volume-xmark text-[8px]"></i>
            </div>
        </div>
    </div>

    <!-- Bottom Right Status -->
    <div class="fixed bottom-4 right-4 text-xs z-50 pointer-events-none select-none">
        <div class="bg-black text-white px-3 py-2 text-right text-[10px] min-w-[100px]">
            <div id="currentSound" class="flex items-center justify-end gap-2">
                <i class="fas fa-circle-notch"></i>
            </div>
            <div id="velocity" class="mt-1 opacity-60 flex items-center justify-end gap-1">
                <i class="fas fa-volume-up text-[8px]"></i>
                <span>0</span>
            </div>
        </div>
    </div>

    <!-- Sequencer Panel Toggle -->
    <button id="seqToggle"
        class="fixed bottom-4 left-4 z-50 bg-black text-white px-3 py-2 border-2 border-black hover:bg-white hover:text-black transition-colors">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sequencer Panel -->
    <div id="seqPanel"
        class="sequencer-panel sequencer-hidden fixed bottom-0 left-0 right-0 bg-white border-t-2 border-black z-40 p-4">
        <div class="max-w-6xl mx-auto">

            <!-- Top Controls -->
            <div class="flex items-center justify-between mb-4">
                <!-- Transport Controls -->
                <div class="flex gap-2">
                    <button id="playBtn" class="bg-black text-white px-4 py-2 hover:bg-gray-800 transition-colors">
                        <i class="fas fa-play"></i>
                    </button>
                    <button id="stopBtn" class="bg-black text-white px-4 py-2 hover:bg-gray-800 transition-colors">
                        <i class="fas fa-stop"></i>
                    </button>
                </div>

                <!-- BPM Control -->
                <div class="flex items-center gap-3">
                    <i class="fas fa-clock"></i>
                    <input id="bpmSlider" type="range" min="60" max="240" value="120" class="w-32">
                    <span id="bpmDisplay" class="font-bold min-w-[3ch]">120</span>
                </div>

                <!-- Selected Island -->
                <div class="flex items-center gap-2">
                    <span class="text-xs">
                        <i class="fas fa-hand-pointer"></i>
                    </span>
                    <span id="selectedIsland" class="text-xs">---</span>
                </div>
            </div>

            <!-- Step Sequencer Grid -->
            <div id="stepGrid" class="grid gap-2" style="grid-template-columns: auto repeat(16, 1fr);">
                <!-- Generated dynamically -->
            </div>

        </div>
    </div>

    <script>
        // Canvas Setup
        const canvas = document.getElementById('stage');
        const c = canvas.getContext('2d');
        let w = canvas.width = window.innerWidth;
        let h = canvas.height = window.innerHeight;

        // Audio samples
        const samples = {
            kick: new Audio('https://raw.githubusercontent.com/ArunMichaelDsouza/javascript-30-course/master/src/01-javascript-drum-kit/sounds/kick.wav'),
            snare: new Audio('https://raw.githubusercontent.com/ArunMichaelDsouza/javascript-30-course/master/src/01-javascript-drum-kit/sounds/snare.wav'),
            hihatOpen: new Audio('https://raw.githubusercontent.com/ArunMichaelDsouza/javascript-30-course/master/src/01-javascript-drum-kit/sounds/hihat-open.wav'),
            hihatClose: new Audio('https://raw.githubusercontent.com/ArunMichaelDsouza/javascript-30-course/master/src/01-javascript-drum-kit/sounds/hihat-close.wav'),
            crash: new Audio('https://raw.githubusercontent.com/ArunMichaelDsouza/javascript-30-course/master/src/01-javascript-drum-kit/sounds/crash.wav'),
            ride: new Audio('https://raw.githubusercontent.com/ArunMichaelDsouza/javascript-30-course/master/src/01-javascript-drum-kit/sounds/ride.wav'),
            tomLow: new Audio('https://raw.githubusercontent.com/ArunMichaelDsouza/javascript-30-course/master/src/01-javascript-drum-kit/sounds/tom-low.wav'),
            tomMid: new Audio('https://raw.githubusercontent.com/ArunMichaelDsouza/javascript-30-course/master/src/01-javascript-drum-kit/sounds/tom-mid.wav'),
            tomHigh: new Audio('https://raw.githubusercontent.com/ArunMichaelDsouza/javascript-30-course/master/src/01-javascript-drum-kit/sounds/tom-high.wav')
        };

        Object.values(samples).forEach(audio => {
            audio.load();
            audio.volume = 0.8;
        });

        // Islands configuration
        const islands = [
            { x: 0.15, y: 0.7, r: 120, color: 20, drum: 'kick', icon: 'fa-drum', name: 'ðŸ¥' },
            { x: 0.65, y: 0.55, r: 85, color: 100, drum: 'snare', icon: 'fa-compact-disc', name: 'ðŸ’¿' },
            { x: 0.25, y: 0.25, r: 55, color: 220, drum: 'hihatClose', icon: 'fa-circle', name: 'â—' },
            { x: 0.35, y: 0.22, r: 50, color: 200, drum: 'hihatOpen', icon: 'fa-circle-dot', name: 'â—‰' },
            { x: 0.85, y: 0.15, r: 95, color: 180, drum: 'crash', icon: 'fa-asterisk', name: 'âœ±' },
            { x: 0.72, y: 0.25, r: 70, color: 160, drum: 'ride', icon: 'fa-certificate', name: 'âœ¦' },
            { x: 0.5, y: 0.6, r: 65, color: 60, drum: 'tomLow', icon: 'fa-circle-notch', name: 'â—' },
            { x: 0.45, y: 0.45, r: 62, color: 80, drum: 'tomMid', icon: 'fa-circle-notch', name: 'â—‘' },
            { x: 0.55, y: 0.35, r: 58, color: 120, drum: 'tomHigh', icon: 'fa-circle-notch', name: 'â—’' }
        ];

        islands.forEach((island, idx) => {
            island.absX = island.x * w;
            island.absY = island.y * h;
            island.pulse = 0;
            island.steps = new Array(16).fill(false);
            island.id = idx;
        });

        // Sequencer state
        let isPlaying = false;
        let currentStep = 0;
        let bpm = 120;
        let stepInterval = null;
        let selectedIslandId = null;

        // Ripples & trail
        const ripples = [];
        const oceanTrail = [];
        const maxTrailPoints = 50;

        // Mouse state
        let lastPos = null;
        let isOverOcean = true;

        // Get island at position
        const getIsland = (x, y) => {
            for (let island of islands) {
                const dx = x - island.absX;
                const dy = y - island.absY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist <= island.r) {
                    return { island, dist, centerDist: dist / island.r };
                }
            }
            return null;
        };

        // Play drum
        const playDrum = (island, velocity = 1) => {
            const audio = samples[island.drum];
            if (!audio) return;

            const clone = audio.cloneNode();
            clone.volume = Math.max(0.3, velocity) * 0.8;
            clone.play().catch(e => console.log('Audio play failed:', e));

            island.pulse = 1;
            ripples.push({ x: island.absX, y: island.absY, r: 0, life: 1 });

            document.getElementById('currentSound').innerHTML = `<i class="fas ${island.icon}"></i>`;
            document.getElementById('velocity').innerHTML = `<i class="fas fa-volume-up text-[8px]"></i><span>${Math.round(velocity * 100)}</span>`;
        };

        // Build sequencer UI
        const buildSequencerUI = () => {
            const grid = document.getElementById('stepGrid');
            grid.innerHTML = '';

            islands.forEach((island, islandIdx) => {
                // Island label
                const label = document.createElement('div');
                label.className = 'flex items-center justify-center text-lg cursor-pointer hover:bg-gray-100 p-2 border border-gray-300';
                label.textContent = island.name;
                label.onclick = () => selectIsland(islandIdx);
                grid.appendChild(label);

                // Steps
                for (let step = 0; step < 16; step++) {
                    const btn = document.createElement('button');
                    btn.className = 'step-btn aspect-square border-2 border-black bg-white hover:bg-gray-200';
                    btn.dataset.island = islandIdx;
                    btn.dataset.step = step;

                    if (island.steps[step]) {
                        btn.classList.add('step-active');
                    }

                    btn.onclick = () => toggleStep(islandIdx, step);
                    grid.appendChild(btn);
                }
            });
        };

        // Select island
        const selectIsland = (id) => {
            selectedIslandId = id;
            document.getElementById('selectedIsland').textContent = islands[id].name;
        };

        // Toggle step
        const toggleStep = (islandId, step) => {
            islands[islandId].steps[step] = !islands[islandId].steps[step];
            buildSequencerUI();
        };

        // Sequencer tick
        const tick = () => {
            islands.forEach(island => {
                if (island.steps[currentStep]) {
                    playDrum(island, 0.9);
                }
            });

            // Update UI
            updateStepHighlight();

            currentStep = (currentStep + 1) % 16;
        };

        // Update step highlight
        const updateStepHighlight = () => {
            document.querySelectorAll('.step-btn').forEach(btn => {
                const step = parseInt(btn.dataset.step);
                if (step === currentStep) {
                    btn.style.boxShadow = '0 0 0 3px #000';
                } else {
                    btn.style.boxShadow = 'none';
                }
            });
        };

        // Transport controls
        document.getElementById('playBtn').onclick = () => {
            if (isPlaying) {
                clearInterval(stepInterval);
                isPlaying = false;
                document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i>';
            } else {
                const stepTime = (60 / bpm) * 1000 / 4; // 16th notes
                stepInterval = setInterval(tick, stepTime);
                isPlaying = true;
                document.getElementById('playBtn').innerHTML = '<i class="fas fa-pause"></i>';
            }
        };

        document.getElementById('stopBtn').onclick = () => {
            clearInterval(stepInterval);
            isPlaying = false;
            currentStep = 0;
            updateStepHighlight();
            document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i>';
        };

        // BPM control
        document.getElementById('bpmSlider').oninput = (e) => {
            bpm = parseInt(e.target.value);
            document.getElementById('bpmDisplay').textContent = bpm;

            if (isPlaying) {
                clearInterval(stepInterval);
                const stepTime = (60 / bpm) * 1000 / 4;
                stepInterval = setInterval(tick, stepTime);
            }
        };

        // Sequencer toggle
        document.getElementById('seqToggle').onclick = () => {
            const panel = document.getElementById('seqPanel');
            panel.classList.toggle('sequencer-hidden');
        };

        // Draw loop
        const draw = () => {
            c.clearRect(0, 0, w, h);

            // Ocean trail
            if (oceanTrail.length > 1) {
                for (let i = 1; i < oceanTrail.length; i++) {
                    const alpha = i / oceanTrail.length;
                    c.strokeStyle = `rgba(0, 0, 0, ${alpha * 0.15})`;
                    c.lineWidth = 2;
                    c.beginPath();
                    c.moveTo(oceanTrail[i - 1].x, oceanTrail[i - 1].y);
                    c.lineTo(oceanTrail[i].x, oceanTrail[i].y);
                    c.stroke();
                }
            }

            // Islands
            islands.forEach(island => {
                const gray = island.color;
                c.fillStyle = `rgb(${gray}, ${gray}, ${gray})`;
                c.beginPath();
                c.arc(island.absX, island.absY, island.r, 0, Math.PI * 2);
                c.fill();

                if (island.pulse > 0) {
                    const pulseR = island.r + (island.pulse * 20);
                    c.strokeStyle = `rgba(0, 0, 0, ${island.pulse * 0.5})`;
                    c.lineWidth = 3;
                    c.beginPath();
                    c.arc(island.absX, island.absY, pulseR, 0, Math.PI * 2);
                    c.stroke();
                    island.pulse -= 0.05;
                    if (island.pulse < 0) island.pulse = 0;
                }

                c.strokeStyle = '#000';
                c.lineWidth = selectedIslandId === island.id ? 4 : 2;
                c.beginPath();
                c.arc(island.absX, island.absY, island.r, 0, Math.PI * 2);
                c.stroke();

                if (island.r > 55) {
                    c.fillStyle = gray > 128 ? '#000' : '#fff';
                    c.font = `${island.r / 3}px Space Mono`;
                    c.textAlign = 'center';
                    c.textBaseline = 'middle';
                    c.fillText(island.name, island.absX, island.absY);
                }
            });

            // Ripples
            for (let i = ripples.length - 1; i >= 0; i--) {
                const ripple = ripples[i];
                ripple.r += 3;
                ripple.life -= 0.02;

                if (ripple.life <= 0) {
                    ripples.splice(i, 1);
                    continue;
                }

                c.strokeStyle = `rgba(0, 0, 0, ${ripple.life * 0.3})`;
                c.lineWidth = 2;
                c.beginPath();
                c.arc(ripple.x, ripple.y, ripple.r, 0, Math.PI * 2);
                c.stroke();
            }

            requestAnimationFrame(draw);
        };

        // Mouse handlers
        canvas.addEventListener('mousedown', (e) => {
            const result = getIsland(e.clientX, e.clientY);
            if (result) {
                const velocity = 1 - (result.centerDist * 0.4);
                playDrum(result.island, velocity);
                selectIsland(result.island.id);
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            const result = getIsland(e.clientX, e.clientY);

            if (!result) {
                oceanTrail.push({ x: e.clientX, y: e.clientY });
                if (oceanTrail.length > maxTrailPoints) oceanTrail.shift();
                canvas.style.cursor = 'crosshair';
            } else {
                oceanTrail.length = 0;
                canvas.style.cursor = 'pointer';
            }
        });

        canvas.addEventListener('mouseleave', () => {
            oceanTrail.length = 0;
        });

        // Touch
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const result = getIsland(touch.clientX, touch.clientY);
            if (result) {
                playDrum(result.island, 1 - (result.centerDist * 0.4));
                selectIsland(result.island.id);
            }
        });

        // Keyboard
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                oceanTrail.length = 0;
                ripples.length = 0;
            }
        });

        // Resize
        window.addEventListener('resize', () => {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
            islands.forEach(island => {
                island.absX = island.x * w;
                island.absY = island.y * h;
            });
        });

        // Init
        buildSequencerUI();
        draw();
    </script>
</body>

</html>